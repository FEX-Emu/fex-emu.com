---
layout: post
title: FEX 2508 Tagged
author: FEX-Emu Maintainers
---

You thought we were done with optimizations? Too bad, we had some massive improvements this month! Let's jump in!

## Big juicy JIT optimizations!
The improvements this month can't be understated for how much performance have been lifted. To start off, let's show off some performance graphs for a handful of games!

<div id="container_perc" style="min-width: 250px; height: 300px; margin: 0 auto">
</div>

And a chart for the averaged FPS numbers recorded from each of these games.
<div id="container_average" style="min-width: 250px; height: 300px; margin: 0 auto">
</div>

As you can see from the tested games, the improvements can be wild depending on what the game is doing! A nearly 39% FPS uplift in Cyberpunk 2077 is
wacky! From various testing we have done, the uplift tends to be closer to Cyberpunk but there are of course other games like God Of War where the
uplift is minimal!

The majority of this performance uplift has come from call-return stack optimizations, where we are now able to take advantage of the ARM CPU's own
call-return prediction hardware, but we have had a variety of optimizations this month that improve both JIT compilation time in addition to execution
time! Additionally now we compile significantly less code since we would have combinatorial explosion of JIT compiles when multiblock was enabled. We
have now made it so each individual block of JIT code is freestanding and usually only gets compiled once.

Another improvement this month is the WINE wow64/arm64ec libraries can now take advantage of Apple Silicon's hardware TSO feature. This happened to
not be implemented with the wow64/arm64ec code path. This will significantly improve performance on that hardware in the case that someone spent the
effort to run a game in that environment.

There's a few other JIT improvements but we could spend all day here if we talked about everything! Have fun gaming with the performance improvements!

## Implement NX bit
This is a fun little security feature which prevents games from executing code that isn't mapped executable. This is a feature that has been around
for a long time in hardware, but FEX has finally implemented it! This fixed a single game that we know of, where it tests to ensure this security
feature is enabled. This usually isn't a problem for most games, but it is kind of funny that a game using NaCL didn't work because of it.

## More anti-debugger/tamper improvements
This month has also gotten a bunch of improvements around behaviour of code that only shows up in anti-tamper or debugger code. Specifically we found
that **Peggle Deluxe** and **Crysis 2: Maximum Edition** usually worked under FEX, but it relied on some subtle self-modifying code that happened to
work. These are either for anti-tamper, or anti-debugging, or maybe even a way to block data mining. We don't know for sure but since the game relies
on it, we just need to support those forms of self-modifying code.

This may also happen to get **some** versions of Denuvo anti-tamper working under FEX, but it isn't guaranteed and will depending on the game and the
particular flavour of that anti-tamper software.

## Upload WINE DLL artifacts
This is a minor thing, but we are trying out uploading the WINE wow64/arm64ec DLL files for every commit. This can be found on [our github actions
page](https://github.com/FEX-Emu/FEX/actions/workflows/wine_dll_artifacts.yml). This is for people that want to tinker with the main branch under
arm64 wine. As usual we will recommend the official releases on our [Launchpad PPA](https://launchpad.net/ex-emu/+archive/ubuntu/fex) but adventerous
users always want more.

See the [2508 Release Notes](https://github.com/FEX-Emu/FEX/releases/tag/FEX-2508) or the [detailed change log](https://github.com/FEX-Emu/FEX/compare/FEX-2507...FEX-2508) in Github.

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
</script>
<script src="https://code.highcharts.com/highcharts.js">
</script>
<script src="https://code.highcharts.com/modules/exporting.js">
</script>

<script type="text/javascript">
Highcharts.chart('container_perc', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'FEX-2508 improvement over FEX-2507.1'
    },
    xAxis: {
        categories: ['Cyperpunk 2077', 'Stray', 'God of War 2018', 'Doom 2016', 'Grim Fandango Remastered', 'Teardown'],
        crosshair: true,
    },
    yAxis: {
        min: 0,
        title: {
            text: '% FPS improvement'
        }
    },
    tooltip: {
        valueSuffix: ' (%)'
    },
    plotOptions: {
        column: {
            pointPadding: 0.2,
            borderWidth: 0
        }
    },
    series: [
        {
            name: '% FPS improvement',
            data: [38.9, 25.2, 4.6, 30.9, 24.7, 12.6]
        }
    ]
});

Highcharts.chart('container_average', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'FPS averages'
    },
    xAxis: {
        categories: ['Cyperpunk 2077', 'Stray', 'God of War 2018', 'Doom 2016', 'Grim Fandango Remastered', 'Teardown'],
        crosshair: true,
    },
    yAxis: {
        min: 0,
        title: {
            text: 'FPS'
        }
    },
    tooltip: {
        valueSuffix: ' (FPS)'
    },
    plotOptions: {
        column: {
            pointPadding: 0.2,
            borderWidth: 0
        }
    },
    series: [
        {
            name: 'FEX-2507.1',
            data: [50.3, 34.1, 64.4, 150.7, 360, 37.8]
        },
        {
            name: 'FEX-2508',
            data: [69.9, 42.7, 67.4, 197.4, 449, 42.6]
        },
    ]
});
</script>
